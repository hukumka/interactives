<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>html page</title>

    <link type="text/css" rel="stylesheet" href="vm/code.css">
    <link type="text/css" rel="stylesheet" href="page.css">

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="vm/vm.js"></script>
    <script>var compiled = {commands: [[19, 2, 0],[17, 1, 2],[19, 3, 2],[17, 2, 3],[18, 4, 100],[17, 3, 4],[17, 5, 2],[16],[17, 6, 1],[16],[8, 5, 5, 6],[17, 6, 3],[16],[25, 5, 5, 6],[17, 4, 5],[17, 6, 1],[16],[17, 5, 6],[19, 7, 1],[17, 6, 7],[18, 8, 2],[17, 9, 3],[16],[23, 8],[22],[24, 8],[17, 7, 8],[17, 8, 7],[16],[18, 9, 0],[7, 8, 8, 9],[19, 9, 1],[15, 8, 9],[18, 9, 0],[17, 8, 9],[17, 9, 8],[16],[17, 10, 3],[16],[5, 9, 9, 10],[1, 86, 9],[17, 9, 7],[16],[17, 10, 8],[16],[7, 9, 9, 10],[17, 10, 6],[16],[15, 9, 10],[20, 9, 6],[17, 10, 6],[16],[17, 11, 4],[16],[18, 12, 4],[17, 13, 6],[16],[17, 14, 5],[16],[23, 12],[22],[24, 12],[9, 11, 11, 12],[7, 10, 10, 11],[15, 9, 10],[20, 9, 5],[17, 10, 5],[16],[17, 11, 4],[16],[7, 10, 10, 11],[15, 9, 10],[18, 9, 0],[17, 10, 7],[16],[17, 11, 8],[16],[18, 12, 1],[7, 11, 11, 12],[23, 9],[22],[24, 9],[20, 9, 8],[12, 9],[14, 9, 9],[0, 35],[21],[18, 3, 2],[18, 4, 1],[17, 5, 1],[16],[23, 4],[22],[24, 4],[9, 3, 3, 4],[17, 0, 3],[21],[21]], function_enters: [[3, 0],[4, 87]], function_links: [[0, 'display'],[1, 'sqrt'],[2, 'alloc_float']], statements: [0, 2, 4, 6, 15, 18, 20, 27, 35, 41, 49, 65, 72, 87], variable_transactions: [{name: 'START', add: true, pos: 1, id: 1, pair: 15}, {name: 'END', add: true, pos: 3, id: 2, pair: 14}, {name: 'SIZE', add: true, pos: 5, id: 3, pair: 13}, {name: 'step', add: true, pos: 14, id: 4, pair: 12}, {name: 'x', add: true, pos: 17, id: 5, pair: 11}, {name: 'f', add: true, pos: 19, id: 6, pair: 10}, {name: 'data', add: true, pos: 26, id: 7, pair: 9}, {name: 'i', add: true, pos: 34, id: 8, pair: 8}, {name: 'i', add: false, pos: 86, id: 8, pair: 7}, {name: 'data', add: false, pos: 86, id: 7, pair: 6}, {name: 'f', add: false, pos: 86, id: 6, pair: 5}, {name: 'x', add: false, pos: 86, id: 5, pair: 4}, {name: 'step', add: false, pos: 86, id: 4, pair: 3}, {name: 'SIZE', add: false, pos: 86, id: 3, pair: 2}, {name: 'END', add: false, pos: 86, id: 2, pair: 1}, {name: 'START', add: false, pos: 86, id: 1, pair: 0}, {name: 'f', add: true, pos: 87, id: 1, pair: 19}, {name: 'x', add: true, pos: 87, id: 2, pair: 18}, {name: 'x', add: false, pos: 98, id: 2, pair: 17}, {name: 'f', add: false, pos: 98, id: 1, pair: 16}]}</script>
    <script src="vm/interface.js"></script>

    <script>
        var graph = null;
        var graph_data = {
            x: null,
            y: null
        }
        var vm = null;
        // create virtual machine instance
        var functions = []
        functions['sqrt'] = {
            arg_count: 1,
            func: function(x){
                return Math.sqrt(x)
            }
        }
        functions['alloc_float'] = {
            arg_count: 1,
            func: "vm.alloc"
        }
        functions['display'] = {
            arg_count: 2,
            func: function(pointer, size){
                var y = vm.get_array(pointer, size);
                graph_data.y = y;
                // you dont want to actually redraw graph each iteration
                // since its perfomance heavy action
                // instead you use VM on_break hook to redraw only then
                // VM pauses execution due to breakpoint or exit execution
                // due to reaching end of program
            }
        }

        // initialize debugger interface

        var prev_load = window.onload;
        window.onload = function(){
            vm = initialize_vm_interface(functions);
            graph = document.getElementById('graph');
            Plotly.plot(graph, [graph_data], {margin: {t: 0} });

            vm.on_break = function(){
                if(graph_data.y === null){
                    return;
                }
                // update grapth
                var x = [];
                var STEP = 0.01;
                for(var i=0; i<graph_data.y.length; ++i){
                    x.push(i*STEP);
                }
                graph_data.x = x;
                Plotly.redraw(graph);
            }
        }
    </script>
</head>

<body>
    <div class="popups">
        <div id="hover_image"></div>
    </div>

    <div class="interface">
        <div id="controls">
            <div id="flow-control">
                <a id="run">run</a><a id="step">step</a><a id="step-in">step-in</a>
            </div>
            <div id="variables"></div>
        </div>
        <div class="code">
            <div class = "function-declaration"><span class="line-number">0</span><span class = "function-head"><span class = "function-name"><span class = "variable"><span class = "c-type">void</span> <span class = "variable-name">display</span></span></span><span class = "operator">(</span><span class = "variable"><span class = "c-type">float*</span> <span class = "variable-name">x</span></span>, <span class = "variable"><span class = "c-type">int</span> <span class = "variable-name">size</span></span><span class = "operator">);</span></span></div><div class = "function-declaration"><span class="line-number">1</span><span class = "function-head"><span class = "function-name"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name">sqrt</span></span></span><span class = "operator">(</span><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name">x</span></span><span class = "operator">);</span></span></div><div class = "function-declaration"><span class="line-number">2</span><span class = "function-head"><span class = "function-name"><span class = "variable"><span class = "c-type">float*</span> <span class = "variable-name">alloc_float</span></span></span><span class = "operator">(</span><span class = "variable"><span class = "c-type">int</span> <span class = "variable-name">size</span></span><span class = "operator">);</span></span></div><div class = "function-definition"><span class="line-number">3</span><span class = "function-head"><span class = "function-name"><span class = "variable"><span class = "c-type">int</span> <span class = "variable-name">main</span></span></span><span class = "operator">(</span><span class = "operator">){</span></span><div class = "function-body"><div class = "statement"data_address = "0"><span class="line-number clickable" data_address="0">4</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "1"data_var_transaction = "0">START</span></span><span class = "variable-definition-eq">=</span><span class = "constant">0.0</span></span>;</span></div><div class = "statement"data_address = "2"><span class="line-number clickable" data_address="2">5</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "2"data_var_transaction = "1">END</span></span><span class = "variable-definition-eq">=</span><span class = "constant">2.0</span></span>;</span></div><div class = "statement"data_address = "4"><span class="line-number clickable" data_address="4">6</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">int</span> <span class = "variable-name"data_var_offset = "3"data_var_transaction = "2">SIZE</span></span><span class = "variable-definition-eq">=</span><span class = "constant">100</span></span>;</span></div><div class = "statement"data_address = "6"><span class="line-number clickable" data_address="6">7</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "4"data_var_transaction = "3">step</span></span><span class = "variable-definition-eq">=</span><span class = "variable-name"data_var_offset = "2"data_var_transaction = "1">END</span><span class = "operator">-</span><span class = "variable-name"data_var_offset = "1"data_var_transaction = "0">START</span><span class = "operator">/</span><span class = "variable-name"data_var_offset = "3"data_var_transaction = "2">SIZE</span></span>;</span></div><div class = "statement"data_address = "15"><span class="line-number clickable" data_address="15">8</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "5"data_var_transaction = "4">x</span></span><span class = "variable-definition-eq">=</span><span class = "variable-name"data_var_offset = "1"data_var_transaction = "0">START</span></span>;</span></div><div class = "statement"data_address = "18"><span class="line-number clickable" data_address="18">9</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "6"data_var_transaction = "5">f</span></span><span class = "variable-definition-eq">=</span><span class = "constant">1.0</span></span>;</span></div><div class = "statement"data_address = "20"><span class="line-number clickable" data_address="20">10</span><span class="tabs"><span class="tab"></span><span class = "variable-definition"><span class = "variable"><span class = "c-type">float*</span> <span class = "variable-name"data_var_offset = "7"data_var_transaction = "6">data</span></span><span class = "variable-definition-eq">=</span><span class = "function-name"><span class = "variable-name"data_var_offset = "$2"data_var_transaction = "0">alloc_float</span></span><span class = "operator">(</span><span class = "variable-name"data_var_offset = "3"data_var_transaction = "2">SIZE</span><span class = "operator">)</span></span>;</span></div><div class = "statement"data_address = "27"><span class="line-number clickable" data_address="27">11</span><span class="tabs"><span class="tab"></span><span class = "variable-name"data_var_offset = "7"data_var_transaction = "6">data</span><span class = "operator">[</span><span class = "constant">0</span><span class = "operator">]</span><span class = "operator">=</span><span class = "constant">1.0</span>;</span></div><div class = "statement"data_address = "35"><span class="line-number clickable" data_address="35">12</span><span class="tabs"><span class="tab"></span><span class = "keyword">for</span>(<span class = "variable-definition"><span class = "variable"><span class = "c-type">int</span> <span class = "variable-name"data_var_offset = "8"data_var_transaction = "7">i</span></span><span class = "variable-definition-eq">=</span><span class = "constant">0</span></span>;<span class = "variable-name"data_var_offset = "8"data_var_transaction = "7">i</span><span class = "operator">&lt;</span><span class = "variable-name"data_var_offset = "3"data_var_transaction = "2">SIZE</span>;<span class = "operator">++</span><span class = "variable-name"data_var_offset = "8"data_var_transaction = "7">i</span>){</span></div><div class = "statement"data_address = "41"><span class="line-number clickable" data_address="41">13</span><span class="tabs"><span class="tab"></span><span class="tab"></span><span class = "variable-name"data_var_offset = "7"data_var_transaction = "6">data</span><span class = "operator">[</span><span class = "variable-name"data_var_offset = "8"data_var_transaction = "7">i</span><span class = "operator">]</span><span class = "operator">=</span><span class = "variable-name"data_var_offset = "6"data_var_transaction = "5">f</span>;</span></div><div class = "statement"data_address = "49"><span class="line-number clickable" data_address="49">14</span><span class="tabs"><span class="tab"></span><span class="tab"></span><span class = "variable-name"data_var_offset = "6"data_var_transaction = "5">f</span><span class = "operator">=</span><span class = "variable-name"data_var_offset = "6"data_var_transaction = "5">f</span><span class = "operator">+</span><span class = "variable-name"data_var_offset = "4"data_var_transaction = "3">step</span><span class = "operator">*</span><span class = "function-name"><span class = "variable-name"data_var_offset = "$4"data_var_transaction = "0">P</span></span><span class = "operator">(</span><span class = "variable-name"data_var_offset = "6"data_var_transaction = "5">f</span>, <span class = "variable-name"data_var_offset = "5"data_var_transaction = "4">x</span><span class = "operator">)</span>;</span></div><div class = "statement"data_address = "65"><span class="line-number clickable" data_address="65">15</span><span class="tabs"><span class="tab"></span><span class="tab"></span><span class = "variable-name"data_var_offset = "5"data_var_transaction = "4">x</span><span class = "operator">=</span><span class = "variable-name"data_var_offset = "5"data_var_transaction = "4">x</span><span class = "operator">+</span><span class = "variable-name"data_var_offset = "4"data_var_transaction = "3">step</span>;</span></div><div class = "statement"data_address = "72"><span class="line-number clickable" data_address="72">16</span><span class="tabs"><span class="tab"></span><span class="tab"></span><span class = "function-name"><span class = "variable-name"data_var_offset = "$0"data_var_transaction = "0">display</span></span><span class = "operator">(</span><span class = "variable-name"data_var_offset = "7"data_var_transaction = "6">data</span>, <span class = "variable-name"data_var_offset = "8"data_var_transaction = "7">i</span><span class = "operator">+</span><span class = "constant">1</span><span class = "operator">)</span>;</span></div><span class="line-number">17</span><span class="tabs"><span class="tab"></span>}</span></div><span class="line-number">18</span><span class = "operator">}</span></div><div class = "function-definition"><span class="line-number">19</span><span class = "function-head"><span class = "function-name"><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name">P</span></span></span><span class = "operator">(</span><span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "1"data_var_transaction = "16">f</span></span>, <span class = "variable"><span class = "c-type">float</span> <span class = "variable-name"data_var_offset = "2"data_var_transaction = "17">x</span></span><span class = "operator">){</span></span><div class = "function-body"><div class = "statement"data_address = "87"><span class="line-number clickable" data_address="87">20</span><span class="tabs"><span class="tab"></span><span class = "keyword">return </span><span class = "constant">2</span><span class = "operator">*</span><span class = "function-name"><span class = "variable-name"data_var_offset = "$1"data_var_transaction = "0">sqrt</span></span><span class = "operator">(</span><span class = "variable-name"data_var_offset = "1"data_var_transaction = "16">f</span><span class = "operator">)</span>;</span></div></div><span class="line-number">21</span><span class = "operator">}</span></div>
        </div>
        <div id="graph">
        </div>
    </div>
</body>
</html>
